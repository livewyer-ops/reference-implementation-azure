# in-cluster ArgoCD cluster Secret for passing metadata to ApplicationSets
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: hub-cluster-secret
  namespace: argocd
spec:
  refreshInterval: "15m"
  secretStoreRef:
    name: aws-secretsmanager
    kind: ClusterSecretStore
  target:
    name: hub-cluster
    template:
      metadata:
        labels:
          argocd.argoproj.io/secret-type: cluster
          clusterClass: "control-plane"
          clusterName: "{{ .clusterName }}"
          environment: "control-plane"
          path_routing: "{{ .pathRouting }}"
        annotations:
          subscription: "{{ .subscription }}"
          resource_group: "{{ .resource_group }}"
          dns_zone_id: "{{ .DNSZoneID }}"
          addons_repo_url: "{{ .repoURL }}"
          addons_repo_revision: "{{ .repoRevision }}"
          addons_repo_basepath: "{{ .repoBasePath }}"
          domain: "{{ .domain }}"
      data:
        name: "{{ .clusterName }}"
        server: https://kubernetes.default.svc
  data:
    - secretKey: subscription
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        key: cnoe-ref-impl/config
        metadataPolicy: None
        property: subscription
    - secretKey: location
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        key: cnoe-ref-impl/config
        metadataPolicy: None
        property: location
    - secretKey: resourceGroup
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        key: cnoe-ref-impl/config
        metadataPolicy: None
        property: resource_group
    - secretKey: clusterName
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        key: cnoe-ref-impl/config
        metadataPolicy: None
        property: cluster_name
    - secretKey: clusterOIDCIssuerURL
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        key: cnoe-ref-impl/config
        metadataPolicy: None
        property: cluster_oidc_issuer_url
    - secretKey: pathRouting
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        key: cnoe-ref-impl/config
        metadataPolicy: None
        property: path_routing
    - secretKey: repoURL
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        key: cnoe-ref-impl/config
        metadataPolicy: None
        property: repo.url
    - secretKey: repoRevision
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        key: cnoe-ref-impl/config
        metadataPolicy: None
        property: repo.revision
    - secretKey: repoBasePath
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        key: cnoe-ref-impl/config
        metadataPolicy: None
        property: repo.basepath
    - secretKey: domain
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        key: cnoe-ref-impl/config
        metadataPolicy: None
        property: domain
    - secretKey: DNSZoneID
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        key: cnoe-ref-impl/config
        metadataPolicy: None
        property: dns_zone_id
